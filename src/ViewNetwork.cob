>>SOURCE FORMAT FREE
IDENTIFICATION DIVISION.
PROGRAM-ID. ViewNetwork.

ENVIRONMENT DIVISION.
INPUT-OUTPUT SECTION.
FILE-CONTROL.
    SELECT ESTABLISHED-CONNECTIONS-FILE ASSIGN TO "data/EstablishedConnections.dat"
        ORGANIZATION IS SEQUENTIAL
        ACCESS MODE IS SEQUENTIAL
        FILE STATUS IS WS-CONNECTIONS-FILE-STATUS.
    SELECT PROFILE-FILE ASSIGN TO "data/profiles.dat"
        ORGANIZATION IS LINE SEQUENTIAL
        FILE STATUS IS WS-PROFILE-FILE-STATUS.

DATA DIVISION.
FILE SECTION.
FD ESTABLISHED-CONNECTIONS-FILE.
01 ESTABLISHED-CONNECTIONS-RECORD.
    05 CONNECTION-USER-ONE PIC X(30).
    05 CONNECTION-USER-TWO PIC X(30).

FD PROFILE-FILE.
01 PROFILE-RECORD.
    05 PROFILE-USERNAME    PIC X(30).
    05 PROFILE-NAME        PIC X(50).
    05 PROFILE-UNIVERSITY  PIC X(50).
    05 PROFILE-MAJOR       PIC X(50).
    05 PROFILE-GRADYEAR    PIC 9(4).
    05 PROFILE-ABOUT       PIC X(200).
    05 PROFILE-JOBTITLE    OCCURS 3 TIMES PIC X(50).
    05 PROFILE-COMPANY     OCCURS 3 TIMES PIC X(50).
    05 PROFILE-DATES       OCCURS 3 TIMES PIC X(30).
    05 PROFILE-DESC        OCCURS 3 TIMES PIC X(200).
    05 PROFILE-DEGREE      OCCURS 3 TIMES PIC X(50).
    05 PROFILE-UNIV        OCCURS 3 TIMES PIC X(50).
    05 PROFILE-YEARS       OCCURS 3 TIMES PIC X(30).

WORKING-STORAGE SECTION.
77 WS-CONNECTIONS-FILE-STATUS       PIC XX VALUE "00".
77 WS-PROFILE-FILE-STATUS           PIC XX VALUE "00".
77 WS-CONNECTIONS-END               PIC X  VALUE "N".
77 WS-PROFILE-END                   PIC X  VALUE "N".
77 WS-MAX-PROFILES                  PIC 9(3) VALUE 200.
77 WS-PROFILE-COUNT                 PIC 9(3) VALUE 0.
77 WS-MAX-CONNECTIONS               PIC 9(3) VALUE 200.
77 WS-CONNECTION-COUNT              PIC 9(3) VALUE 0.
77 WS-PROFILE-INDEX                 PIC 9(3) VALUE 0.
77 WS-CONNECTION-INDEX              PIC 9(3) VALUE 0.
77 WS-DUPLICATE-CONNECTION-FOUND    PIC X VALUE "N".
77 WS-CURRENT-CONNECTED-USERNAME    PIC X(30) VALUE SPACES.
77 WS-DISPLAY-NAME                  PIC X(50) VALUE SPACES.
77 WS-DISPLAY-UNIVERSITY            PIC X(50) VALUE SPACES.
77 WS-DISPLAY-MAJOR                 PIC X(50) VALUE SPACES.
77 WS-NETWORK-LINE                  PIC X(220) VALUE SPACES.
01 WS-PROFILE-TABLE.
    05 WS-PROFILE-ENTRY OCCURS 200 TIMES.
        10 WS-TABLE-USERNAME        PIC X(30).
        10 WS-TABLE-NAME            PIC X(50).
        10 WS-TABLE-UNIVERSITY      PIC X(50).
        10 WS-TABLE-MAJOR           PIC X(50).
01 WS-CONNECTION-TABLE.
    05 WS-CONNECTED-USERNAME OCCURS 200 TIMES PIC X(30).

LINKAGE SECTION.
01 LNK-LOGGED-IN-USERNAME PIC X(30).

PROCEDURE DIVISION USING LNK-LOGGED-IN-USERNAME.

MAIN.
    DISPLAY "--- Your Network ---"

    PERFORM LOAD-PROFILE-DATA
    PERFORM LOAD-USER-CONNECTIONS

    IF WS-CONNECTION-COUNT = 0
        DISPLAY "You have no established connections."
    ELSE
        PERFORM DISPLAY-CONNECTION-LIST
    END-IF

    DISPLAY "--------------------"
    GOBACK.

LOAD-PROFILE-DATA.
    MOVE 0 TO WS-PROFILE-COUNT
    MOVE "N" TO WS-PROFILE-END

    OPEN INPUT PROFILE-FILE

    IF WS-PROFILE-FILE-STATUS NOT = "00"
        IF WS-PROFILE-FILE-STATUS NOT = "35"
            DISPLAY "Error opening profiles.dat: " WS-PROFILE-FILE-STATUS
        END-IF
        EXIT PARAGRAPH
    END-IF

    PERFORM UNTIL WS-PROFILE-END = "Y" OR WS-PROFILE-COUNT >= WS-MAX-PROFILES
        READ PROFILE-FILE
            AT END
                MOVE "Y" TO WS-PROFILE-END
            NOT AT END
                ADD 1 TO WS-PROFILE-COUNT
                MOVE PROFILE-USERNAME   TO WS-TABLE-USERNAME(WS-PROFILE-COUNT)
                MOVE PROFILE-NAME       TO WS-TABLE-NAME(WS-PROFILE-COUNT)
                MOVE PROFILE-UNIVERSITY TO WS-TABLE-UNIVERSITY(WS-PROFILE-COUNT)
                MOVE PROFILE-MAJOR      TO WS-TABLE-MAJOR(WS-PROFILE-COUNT)
        END-READ
    END-PERFORM

    CLOSE PROFILE-FILE.

LOAD-USER-CONNECTIONS.
    MOVE 0 TO WS-CONNECTION-COUNT
    MOVE "N" TO WS-CONNECTIONS-END

    OPEN INPUT ESTABLISHED-CONNECTIONS-FILE

    IF WS-CONNECTIONS-FILE-STATUS = "35"
        EXIT PARAGRAPH
    END-IF

    IF WS-CONNECTIONS-FILE-STATUS NOT = "00"
        DISPLAY "Error opening EstablishedConnections.dat: " WS-CONNECTIONS-FILE-STATUS
        EXIT PARAGRAPH
    END-IF

    PERFORM UNTIL WS-CONNECTIONS-END = "Y"
        READ ESTABLISHED-CONNECTIONS-FILE
            AT END
                MOVE "Y" TO WS-CONNECTIONS-END
            NOT AT END
                IF CONNECTION-USER-ONE = LNK-LOGGED-IN-USERNAME
                    MOVE CONNECTION-USER-TWO TO WS-CURRENT-CONNECTED-USERNAME
                    PERFORM ADD-CONNECTED-USERNAME-IF-NEW
                END-IF
                IF CONNECTION-USER-TWO = LNK-LOGGED-IN-USERNAME
                    MOVE CONNECTION-USER-ONE TO WS-CURRENT-CONNECTED-USERNAME
                    PERFORM ADD-CONNECTED-USERNAME-IF-NEW
                END-IF
        END-READ
    END-PERFORM

    CLOSE ESTABLISHED-CONNECTIONS-FILE.

ADD-CONNECTED-USERNAME-IF-NEW.
    IF WS-CURRENT-CONNECTED-USERNAME = SPACES
        EXIT PARAGRAPH
    END-IF

    IF WS-CURRENT-CONNECTED-USERNAME = LNK-LOGGED-IN-USERNAME
        EXIT PARAGRAPH
    END-IF

    MOVE "N" TO WS-DUPLICATE-CONNECTION-FOUND
    PERFORM VARYING WS-CONNECTION-INDEX FROM 1 BY 1 UNTIL WS-CONNECTION-INDEX > WS-CONNECTION-COUNT
        IF WS-CONNECTED-USERNAME(WS-CONNECTION-INDEX) = WS-CURRENT-CONNECTED-USERNAME
            MOVE "Y" TO WS-DUPLICATE-CONNECTION-FOUND
            EXIT PERFORM
        END-IF
    END-PERFORM

    IF WS-DUPLICATE-CONNECTION-FOUND = "N"
        IF WS-CONNECTION-COUNT < WS-MAX-CONNECTIONS
            ADD 1 TO WS-CONNECTION-COUNT
            MOVE WS-CURRENT-CONNECTED-USERNAME TO WS-CONNECTED-USERNAME(WS-CONNECTION-COUNT)
        END-IF
    END-IF.

DISPLAY-CONNECTION-LIST.
    PERFORM VARYING WS-CONNECTION-INDEX FROM 1 BY 1 UNTIL WS-CONNECTION-INDEX > WS-CONNECTION-COUNT
        MOVE WS-CONNECTED-USERNAME(WS-CONNECTION-INDEX) TO WS-CURRENT-CONNECTED-USERNAME
        PERFORM LOOKUP-CONNECTED-USER-PROFILE
        PERFORM DISPLAY-SINGLE-CONNECTION
    END-PERFORM.

LOOKUP-CONNECTED-USER-PROFILE.
    MOVE WS-CURRENT-CONNECTED-USERNAME TO WS-DISPLAY-NAME
    MOVE SPACES TO WS-DISPLAY-UNIVERSITY
    MOVE SPACES TO WS-DISPLAY-MAJOR

    PERFORM VARYING WS-PROFILE-INDEX FROM 1 BY 1 UNTIL WS-PROFILE-INDEX > WS-PROFILE-COUNT
        IF WS-TABLE-USERNAME(WS-PROFILE-INDEX) = WS-CURRENT-CONNECTED-USERNAME
            IF WS-TABLE-NAME(WS-PROFILE-INDEX) NOT = SPACES
                MOVE WS-TABLE-NAME(WS-PROFILE-INDEX) TO WS-DISPLAY-NAME
            END-IF
            MOVE WS-TABLE-UNIVERSITY(WS-PROFILE-INDEX) TO WS-DISPLAY-UNIVERSITY
            MOVE WS-TABLE-MAJOR(WS-PROFILE-INDEX) TO WS-DISPLAY-MAJOR
            EXIT PERFORM
        END-IF
    END-PERFORM.

DISPLAY-SINGLE-CONNECTION.
    MOVE SPACES TO WS-NETWORK-LINE

    IF WS-DISPLAY-UNIVERSITY NOT = SPACES
        OR WS-DISPLAY-MAJOR NOT = SPACES
        STRING "Connected with: "
               FUNCTION TRIM(WS-DISPLAY-NAME)
               " (University: "
               FUNCTION TRIM(WS-DISPLAY-UNIVERSITY)
               ", Major: "
               FUNCTION TRIM(WS-DISPLAY-MAJOR)
               ")"
            DELIMITED BY SIZE INTO WS-NETWORK-LINE
    ELSE
        STRING "Connected with: "
               FUNCTION TRIM(WS-DISPLAY-NAME)
            DELIMITED BY SIZE INTO WS-NETWORK-LINE
    END-IF

    DISPLAY FUNCTION TRIM(WS-NETWORK-LINE).

END PROGRAM ViewNetwork.
